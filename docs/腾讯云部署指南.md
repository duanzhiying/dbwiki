# 腾讯云静态网站托管部署指南（含 Gitee 自动部署）

本指南帮助将 MkDocs + Material 主题网站部署到腾讯云对象存储 COS 并开启静态网站功能，支持直接绑定 Gitee 仓库自动构建发布。

## 一、前置条件
- 已有腾讯云账号且完成实名认证
- 已在 Gitee 建好仓库（例如：`https://gitee.com/kidzying/dbwiki.git`）
- 本地可构建（可选）
  - `python3 -m pip install -r requirements.txt`
  - `python scripts/sync_docs.py`
  - `python3 -m mkdocs build --clean`

## 二、创建并配置存储桶（COS）
1. 打开“对象存储 COS”存储桶列表：`https://console.cloud.tencent.com/cos/bucket`
2. 右上角“创建存储桶”：
   - 名称：如 `dbwiki-site`
   - 地域：就近（如 `ap-shanghai`）
   - 访问权限：选择“公有读私有写”（适合静态网站）
   - 服务端加密：选择“不加密”
   - 创建完成
3. 进入存储桶 → 左侧“基础配置” → 找到“静态网站”卡片 → 右上角“编辑” → 开启
   - 索引文档：`index.html`
   - 错误文档：可留空或 `404.html`
   - 保存后会显示“静态网站访问域名”（形如 `https://<bucket>.cos-website.<region>.myqcloud.com`）

说明：2024-01-01 后创建的桶默认域名不支持浏览器预览，但“静态网站访问域名”可直接访问，无需自定义域名。

## 三、方式A：先手动验证（最小闭环）
1. 本地构建产物：
   ```bash
   python3 -m pip install -r requirements.txt
   python scripts/sync_docs.py
   python3 -m mkdocs build --clean
   ```
2. 上传 `site/` 的全部文件到存储桶“对象管理”的根目录
3. 使用“静态网站访问域名”在浏览器访问，确认页面能打开

## 四、方式B：直接绑定 Gitee 仓库自动部署（推荐）
1. 打开存储桶页面 → 找到“静态网站”或“部署/自动部署”入口
2. 选择“Git 自动部署”或“从代码仓库构建”：
   - 代码平台：选择 Gitee
   - 连接授权：按指引授权腾讯云访问你的 Gitee 仓库
   - 仓库地址：选择 `dbwiki` 仓库
   - 分支：`main`
   - 构建环境：Python 3.9
   - 构建命令：
     ```bash
     python3 -m pip install -r requirements.txt && \
     python scripts/sync_docs.py && \
     python3 -m mkdocs build --clean
     ```
   - 输出目录：`site`
3. 保存并“启用自动部署”
4. 之后每次向 Gitee `main` 分支推送代码，会自动：拉取 → 安装依赖 → 同步内容 → 构建 → 发布到 COS

若你的控制台暂未开放“直接绑定 Gitee”的入口，可改用 CODING DevOps（腾讯云旗下）或本地/CI 同步方式。

## 五、（可选）使用 CODING DevOps 实现自动化
1. 在 CODING 创建项目并连接 Gitee 仓库
2. 配置流水线：
   - 安装依赖 → 同步 `knowledge_base` → 构建 MkDocs → 使用 coscmd/ossutil 同步 `site/` 到 COS
3. 触发条件：`main` 分支推送

## 六、项目内已提供的辅助文件
- `scripts/sync_docs.py`：将 `knowledge_base/` 同步到 `docs/`，并做元数据与命名校验
- `tencent-cloud.yml`：本地参考配置（非腾讯云官方规范文件，仅供记录构建命令与输出）
- `vercel.json`：原 Vercel 配置（无需用于腾讯云）

## 七、常见问题
- 访问 403/404：
  - 桶权限需为“公有读私有写”
  - 确认“静态网站”已开启，且 `index.html` 位于桶根目录
- 默认域名无法预览：
  - 使用“静态网站访问域名”而非默认域名
- 构建失败：
  - 检查构建日志
  - 确认 Python 版本与依赖
  - `mkdocs.yml` 中引用的文档是否存在

## 八、后续与优化
- 绑定自定义域名（可选）：体验更好，支持免费 HTTPS 证书
- 接入 CI（CODING 或 GitHub Actions）：更灵活的构建与质量检查
- 内容协作：坚持在 `knowledge_base/` 编辑 → `sync_docs.py` → `docs/` → 构建

—
最后更新：2025-09-04
维护者：kidzying
